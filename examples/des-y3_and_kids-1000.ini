; This is currently set up to run a quick test sampler
; TODO add info on the polychord settings
[runtime]
sampler = test
verbosity = standard

; We will carry out a joint Hybrid pipeline analysis of 
; DES Y3 xi_pm and KiDS-1000 COSEBIS including scale cuts (2'<theta_min<300')
[DEFAULT]
DATAFILE=likelihood/des-y3_and_kids-1000/DES-Y3_xipm_and_KiDS-1000_COSEBIs_2.0_300.0.fits
RUN_NAME = des-y3_and_kids-1000

[pipeline]
modules =   sample_S8 sigma8toAs camb extrapolate 
            fits_nz_des correlated_dz_priors fits_nz_kids photoz_bias_des photoz_bias_kids 
            fast_pt choose_des_ia IA 
            pk_to_cl_des add_intrinsic add_eb shear_2pt_eplusb shear_2pt_eminusb choose_xip shear_m_bias 2pt_like 
            choose_kids_ia IA 
            pk_to_cl_kids add_intrinsic cosebis scale_cuts cosebis_like
likelihoods = 2pt cosebis
values  = examples/des-y3_and_kids-1000-values.ini
priors  = examples/des-y3_and_kids-1000-priors.ini
extra_output =  cosmological_parameters/S_8 cosmological_parameters/sigma_8 
                cosmological_parameters/A_s cosmological_parameters/omega_m 
                cosmological_parameters/omega_lambda cosmological_parameters/cosmomc_theta 
                delta_z_out_kids/bin_1 delta_z_out_kids/bin_2 delta_z_out_kids/bin_3 
                delta_z_out_kids/bin_4 delta_z_out_kids/bin_5 
                delta_z_out_des/bin_1 delta_z_out_des/bin_2 delta_z_out_des/bin_3 
                delta_z_out_des/bin_4 
                data_vector/2pt_chi2 likelihoods/cosebis_like likelihoods/2pt_like
quiet = F
timing = F
debug = T

%TO DO
[sample_S8]
file = %(KIDS_MODULES)s/utils/sample_S8.py
s8_name = s_8_input

%TO DO
[sigma8toAs]
file = %(KIDS_MODULES)s/utils/sigma8toAs.py

[camb]
file = boltzmann/camb/camb_interface.py
mode = all
halofit_version = mead2020_feedback  
neutrino_hierarchy = normal
lmax=2500
kmax=100.0
zmid = 2.0
nz_mid = 100
zmax = 6.0
nz = 150
background_zmax = 6.0
background_zmin = 0.0
background_nz = 6000
feedback=0

[extrapolate]
file = boltzmann/extrapolate/extrapolate_power.py
kmax = 500.

[fits_nz_des]
file = number_density/load_nz_fits/load_nz_fits.py
nz_file = $DATAFILE
data_sets = %(redshift_name_des)s_des


[correlated_dz_priors]
file = %(KIDS_MODULES)s/utils/correlated_priors.py
uncorrelated_parameters =   nofz_shifts_kids/uncorr_bias_1 nofz_shifts_kids/uncorr_bias_2 
                            nofz_shifts_kids/uncorr_bias_3 nofz_shifts_kids/uncorr_bias_4 
                            nofz_shifts_kids/uncorr_bias_5
output_parameters = nofz_shifts_kids/bias_1 nofz_shifts_kids/bias_2 
                    nofz_shifts_kids/bias_3 nofz_shifts_kids/bias_4 
                    nofz_shifts_kids/bias_5
covariance = likelihood/des-y3_and_kids-1000/nofz_covariance/SOM_cov_multiplied.asc

[fits_nz_kids]
file = %(CSL_PATH_KIDS)s/number_density/load_nz_fits/load_nz_fits.py
nz_file = $DATAFILE
data_sets = %(redshift_name_kids)s_kids
; data_sets_output = %(redshift_name_kids)s_kids



[photoz_bias_des]
file = %(CSL_PATH_KIDS)s/number_density/photoz_bias/photoz_bias.py
mode = additive
sample = nz_%(redshift_name_des)s_des
bias_section = wl_photoz_errors_des
interpolation = cubic
output_deltaz = T
output_section_name = delta_z_out_des


[photoz_bias_kids]
file = %(CSL_PATH_KIDS)s/number_density/photoz_bias/photoz_bias.py
mode = additive
sample = nz_%(redshift_name_kids)s_kids
bias_section = nofz_shifts_kids
interpolation = cubic
output_deltaz = T
output_section_name = delta_z_out_kids

[pk_to_cl_kids]
file = cosmosis-standard-library/structure/projection/project_2d.py
ell_min_logspaced = 0.1
ell_max_logspaced = 5.0e5
n_ell_logspaced = 100 
shear-shear = source_kids-source_kids
shear-intrinsic = source_kids-source_kids
intrinsic-intrinsic = source_kids-source_kids
intrinsicb-intrinsicb=source_kids-source_kids
verbose = F
get_kernel_peaks = F
sig_over_dchi = 20. 
shear_kernel_dchi = 10.


[pk_to_cl_des]
file = cosmosis-standard-library/structure/projection/project_2d.py
ell_min_logspaced = 0.1
ell_max_logspaced = 5.0e5
n_ell_logspaced = 100
shear-shear = source_des-source_des
shear-intrinsic = source_des-source_des
intrinsic-intrinsic = source_des-source_des
intrinsicb-intrinsicb=source_des-source_des
verbose = F
get_kernel_peaks = F
sig_over_dchi = 20.
shear_kernel_dchi = 10.

[choose_des_ia]
file =  intrinsic_alignments/choose_ia/choose_ia_params.py
suffix = des
 
[choose_kids_ia]
file = intrinsic_alignments/choose_ia/choose_ia_params.py
suffix = kids




[cosebis]
file = %(COSEBIs_PATH)s/libcosebis.so
theta_min = %(tmin)s ; default=1
theta_max = %(tmax)s ; default=100
n_max = %(nmax)s ; default=10
input_section_name = shear_cl
output_section_name = cosebis

Wn_Output_FolderName = ${BASE}/modules/kids/cosebis/WnLog/ 
Roots_n_Norms_FolderName = ${BASE}/modules/kids/cosebis/TLogsRootsAndNorms ; default is ./cosebis/TLogsRootsAndNorms
Tn_Output_FolderName = ${BASE}/modules/kids/cosebis/Tn_Output_Folder ; default is ./cosebis/TpnLog/

[scale_cuts]
file = ${BASE}/modules/kids/scale_cuts/scale_cuts.py
output_section_name = scale_cuts_output
data_and_covariance_fits_filename = ${DATAFILE}
use_stats = En
keep_ang_En   = 0.5 5.5
xi_plus_extension_name = xip
xi_minus_extension_name = xim
bandpower_ggl_extension_name = PneE
bandpower_e_cosmic_shear_extension_name = PeeE
cosebis_extension_name = En
xi_plus_section_name = shear_xi_plus_binned
xi_minus_section_name = shear_xi_minus_binned
bandpower_ggl_section_name = bandpower_galaxy_shear
bandpower_e_cosmic_shear_section_name = bandpower_shear_e
cosebis_section_name = cosebis
simulate = F
simulate_with_noise = F
mock_filename = mock_kids1000_cosebis_nonoise

[cosebis_like]
file = ${BASE}/modules/kids/utils/mini_like.py
input_section_name = scale_cuts_output
like_name = cosebis